Menu="NetworkServices"
Type="xmenu"
Title="DVM"
Icon="pie-chart"
Tag="pie-chart"
Markdown="false"
---
<?PHP
/* Copyright Derek Macias (parts of code from NUT package)
 * Copyright macester (parts of code from NUT package)
 * Copyright gfjardim (parts of code from NUT package)
 * Copyright SimonF (parts of code from NUT package)
 * Copyright Mohamed Emad (icon from vnstat-client package)
 * Copyright desertwitch
 *
 * Copyright Dan Landon
 * Copyright Bergware International
 * Copyright Lime Technology
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License 2
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 */
?>
<? require_once '/usr/local/emhttp/plugins/dwdvm/include/dwdvm_config.php'; ?>

<div> 
<table class="tablesorter shift">
<thead><tr><th>Network Interface</th><th>Summary</th><th>By 5 Minutes</th><th>By Hours</th><th>By Days</th><th>By Months</th><th>By Years</th></tr></thead>
<tbody>
<?if ($dwdvm_running):?>
<?PHP
$dbifaces = shell_exec("vnstat --dbiflist | sed 's/Interfaces in database: //g' 2>/dev/null");
$dbifacesarray = explode(" ", trim($dbifaces));
foreach($dbifacesarray as $dbiface ) {
    shell_exec("vnstati --small --noheader --nolegend -s -c 1 -o /usr/local/emhttp/plugins/dwdvm/images/".$dbiface."_s.png -i ".$dbiface);
    shell_exec("vnstati --small --noheader --nolegend -5 -c 1 -o /usr/local/emhttp/plugins/dwdvm/images/".$dbiface."_5.png -i ".$dbiface);
    shell_exec("vnstati --small --noheader --nolegend -h -c 1 -o /usr/local/emhttp/plugins/dwdvm/images/".$dbiface."_h.png -i ".$dbiface);
    shell_exec("vnstati --small --noheader --nolegend -d -c 1 -o /usr/local/emhttp/plugins/dwdvm/images/".$dbiface."_d.png -i ".$dbiface);
    shell_exec("vnstati --small --noheader --nolegend -m -c 1 -o /usr/local/emhttp/plugins/dwdvm/images/".$dbiface."_m.png -i ".$dbiface);
    shell_exec("vnstati --small --noheader --nolegend -y -c 1 -o /usr/local/emhttp/plugins/dwdvm/images/".$dbiface."_y.png -i ".$dbiface);
    echo("<tr>");
    echo("<td>".$dbiface."</td>");
    echo("<td><details><summary>...</summary><img src='/plugins/dwdvm/images/".$dbiface."_s.png'><pre style='font-size:x-small;'>".shell_exec("vnstat -s -i ".$dbiface)."</pre></details></td>");
    echo("<td><details><summary>...</summary><img src='/plugins/dwdvm/images/".$dbiface."_5.png'><pre style='font-size:x-small;'>".shell_exec("vnstat -5 -i ".$dbiface)."</pre></details></td>");
    echo("<td><details><summary>...</summary><img src='/plugins/dwdvm/images/".$dbiface."_h.png'><pre style='font-size:x-small;'>".shell_exec("vnstat -h -i ".$dbiface)."</pre></details></td>");
    echo("<td><details><summary>...</summary><img src='/plugins/dwdvm/images/".$dbiface."_d.png'><pre style='font-size:x-small;'>".shell_exec("vnstat -d -i ".$dbiface)."</pre></details></td>");
    echo("<td><details><summary>...</summary><img src='/plugins/dwdvm/images/".$dbiface."_m.png'><pre style='font-size:x-small;'>".shell_exec("vnstat -m -i ".$dbiface)."</pre></details></td>");
    echo("<td><details><summary>...</summary><img src='/plugins/dwdvm/images/".$dbiface."_y.png'><pre style='font-size:x-small;'>".shell_exec("vnstat -y -i ".$dbiface)."</pre></details></td>");
    echo("</tr>");
}
?>
<?endif;?>
</tbody>
</table>
</div>

<script>
$(function() {
    showStatus('vnstatd');

    // dynamix plugin update api
    <?if (function_exists('plugin_update_available') && $version = plugin_update_available('dwdvm')):?>
        showNotice('DVM <?=htmlspecialchars($version);?> available. <a>Update</a>','dwdvm');
        $('#user-notice a').on('click', function () {
        $('#user-notice').empty();
    });
    <?endif;?>
});
</script>
